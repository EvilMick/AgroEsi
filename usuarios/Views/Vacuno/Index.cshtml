@model usuarios.Models.Busqueda
@using Chart.Mvc.ComplexChart;
@using Chart.Mvc.Extensions;

@{
    ViewBag.Title = "Datos de precios";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/Chart.js"></script>
<script src="~/Scripts/Chart.js"></script>

@using (Html.BeginForm("Index", "Vacuno", FormMethod.Get))
{
    @Html.ValidationSummary(false)
    <div style="border-bottom:1px solid #bbb"><h1>Cuadro de mandos: </h1></div>
    <table style="border:0px; width:500px;">
        <tr>
            <td>
                <div class="editor-label" style="margin-left:5px">
                    @Html.LabelFor(model => model.producto)
                </div>

                <div class="list-inline" style="margin-left:5px">
                    @Html.DropDownListFor(model => model.producto, new SelectList(Model.productosVC, "Value", "Text"))
                </div>
            </td>
            <td>
                <div class="editor-label" style="margin-left:5px">
                    @Html.LabelFor(model => model.campaña)
                </div>

                <div class="list-inline" style="margin-left:5px">
                    @Html.DropDownListFor(model => model.campaña, new SelectList(Model.campañasTalavera, "Value", "Text"))
                </div>
            </td>
            <td>
                <div class="editor-label" style="margin-left:5px">
                    @Html.LabelFor(model => model.mes)
                </div>

                <div class="list-inline" style="margin-left:5px">
                    @Html.DropDownListFor(model => model.mes, new SelectList(Model.mesesAño, "Value", "Text"))
                </div>
            </td>
            <td>
                <div class="editor-label" style="margin-left:5px">
                    <label>           </label>
                </div>
                <div class="editor-field" style="margin-left:5px">
                    <input name="botonbuscar" type="submit" value="Buscar" class="btn-primary" />
                </div>
            </td>
        </tr>
    </table>

    var barChart = new BarChart();
    barChart.ChartConfiguration.ScaleBeginAtZero = false;
    barChart.ChartConfiguration.ScaleGridLineColor = "rgba(0, 0, 0, 0.3)";
    barChart.ComplexData.Labels.AddRange(Model.fechas);
    barChart.ComplexData.Datasets.AddRange(new List<ComplexDataset>
                             {
                                new ComplexDataset
                                    {
                                        Data = Model.precios,
                                        FillColor = "rgba(102, 51, 153,1)",
                                        StrokeColor = "rgba(220,220,220,1)",
                                        PointColor = "rgba(220,220,220,1)",
                                        PointStrokeColor = "#fff",
                                        PointHighlightFill = "#fff",
                                        PointHighlightStroke = "rgba(220,220,220,1)",
                                    }
                            });

    var lineChart = new LineChart();
    lineChart.ChartConfiguration.ScaleGridLineColor = "rgba(0, 0, 0, 0.3)";
    lineChart.ComplexData.Labels.AddRange(Model.fechas);
    lineChart.ComplexData.Datasets.AddRange(new List<ComplexDataset>
                             {
                                new ComplexDataset
                                    {
                                        Data = Model.precios,
                                        FillColor = "rgba(255, 255, 255, 0)",
                                        StrokeColor = "rgba(0, 0, 0, 1)",
                                        PointColor = "rgba(240, 20, 159,1)",
                                        PointStrokeColor = "#fff",
                                        PointHighlightFill = "#fff",
                                        PointHighlightStroke = "rgba(220,220,220,1)",
                                    }
                            });
    <div class="panel-body">
        <div class="col-md-3" title="2002-2017">
            <div class="well" style="background-color:white">
                <h2 class="text-center"><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>16</h2>
                <h4 class="text-center">Número de campañas</h4>
            </div>
        </div>
        <div class="col-md-3" title="@Model.actual.fecha">
            <div class="well" style="background-color:white">
                <h2 class="text-center"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> @Model.actual.precio</h2>
                <h4 class="text-center">Valor más reciente</h4>
            </div>
        </div>
        <div class="col-md-3" title="@Model.maxHistorico.fecha">
            <div class="well" style="background-color:white">
                <h2 class="text-center"><span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span> @System.Convert.ToDouble(Model.maxHistorico.precio)</h2>
                <h4 class="text-center">Máximo Histórico</h4>
            </div>
        </div>
        <div class="col-md-3" title="@Model.minHistorico.fecha">
            <div class="well" style="background-color:white">
                <h2 class="text-center"><span class="glyphicon glyphicon-hand-down" aria-hidden="true"></span>@System.Convert.ToDouble(Model.minHistorico.precio)</h2>
                <h4 class="text-center">Mínimo Histórico</h4>
            </div>
        </div>
        <div class="col-md-8">
            <div class="col-md-5" style="align-content:center">
                <h3>Evolución de precios:</h3>
            </div>
        </div>
        <div class="col-md-8">
            <div class="col-md-5" style="margin-right:40px">
                <canvas width="320" height="350" id="left"></canvas>
                @if (Model.precios.Count>2)
                {
                    @Html.CreateChart("left", barChart)
                }
                
            </div>
            <div class="col-md-5" style="margin-left:55px">
                <canvas width="320" height="350" id="center"></canvas>
                @if (Model.precios.Count > 2)
                {
                    @Html.CreateChart("center", lineChart)
                }
            </div>
            @if (Model.resultados != null)
            {
                <table class="table table-striped table-hover" style="margin-top:20px">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Variedad</th>
                            <th>Precio</th>
                            <th>Tipo precio</th>
                            <th>Medida</th>
                            <th>Fecha</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var product in Model.resultados)
                        {
                            <tr class="info">
                                <td align="center">@product.producto</td>
                                <td align="center">@product.variedad</td>
                                <td align="right">@product.precio</td>
                                <td align="center">@product.tipoPrecio</td>
                                <td align="center">@product.medida</td>
                                <td align="center">@product.fecha</td>
                            </tr>
                        }
                    </tbody>
                </table>

            }
        </div>
    </div>

}

